
#### SID (security identifier)

SID is used to identify entities. It is assigned to each entity or principal that can be authenticated by Windows. 

The SID for local accounts and groups is generated by the Local Security Authority (LSA).

The SID for domain users and groups is generated by the Domain Controller (DC).

SID cannot be changed and it generated when the user/group is created.

`S-R-X-Y` - placeholders representing structure of SID.
	`S` indicated the string is an SID
	`R` revision, always set to 1 since it cannot be changed and is always the initial version
	`X` determines identifier authority. `5` is the most common (NT Authority)
	`Y` represents sub authorities of `X`, consisting of the `domain identifier` and `relative identifier (RID)` 

The `domain identifier` is the SID of the domain for domain users, the local machine for local users and "32" for built-in principles.

The `RID` determines principles  such as users or groups. RIDs start at 1000, and RIDs below 1000 are `well known SIDs`, which are generic built in groups and users.

```
# useful wellknown SIDs for PrivEsc

S-1-0-0                       Nobody        
S-1-1-0	                      Everybody
S-1-5-11                      Authenticated Users
S-1-5-18                      Local System
S-1-5-domainidentifier-500    Administrator

```

#### Access token

Access tokens are assigned to a user when they authenticate with the system. This token has various pieces of information that describe the security context of the user, this includes rules or attributes in effect.

Access tokens consist of the `SID` of the user, `SID` of the groups the users is apart of, the `user and group privileges`, and information about `scope` of the token.

Access tokens are attached to processes/threads started by the user, and are a duplication of the users access token, this is called the `Primary Token`, which determines the permissions of the process/thread when interacting with other objects on the system.

a thread can also have an `Impersonation token` assigned. These provide a different security context to the thread than the process that owns the thread. This allows the thread to act on behalf of the `Impersonation token` rather than the `Primary token`.

#### Mandatory Integrity Control

MIC uses `integrity levels` to control access to securable objects. It works like a hierarchy of trust windows has in the running application or securable object.

upon creating of a process or securable object they receive the integrity level of the principal performing the operation. `with the exception; if a low integrity exe is executed the process with always be low integrity`.

Lower integrity levels cannot write to objects with higher integrity levels even with permissions that would normally allow them to.

Integrity level hierarchy:

```
- System: SYSTEM (kernel, ...)
- High: Elevated users
- Medium: Standard users
- Low: Very restricted rights often used in sandboxed[^privesc_win_sandbox] processes or for directories storing temporary data
- Untrusted: Lowest integrity level with extremely limited access rights for processes or objects that pose the most potential risk
```

We can display integrity level of processes with `Process Explorer`, for our current user with `whoami /groups` and for files with `icacls`.

#### User Account Control (UAC)

UAC is a security feature that protects the operating system by running most applications and tasks with standard user privileges even if the user launching is an Administrator.

An Administrative user obtains two access tokens after a successful logon. The `standard user token (filetered admin token)` and the `administrator token` which is used to perform privileged operations which requires interaction/confirmation with a UAC consent prompt.